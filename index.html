<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MatchaTone â€” state videos</title>
  <link rel="stylesheet" href="style.css"/>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.3/lib/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.3/lib/addons/p5.sound.min.js"></script>
</head>
<body>
  <div id="app">
    <div id="loading">Loadingâ€¦</div>

    <!-- ä¸­å¿ƒåŒºåŸŸï¼šåªæ˜¾ç¤ºè§’è‰²å’Œä¸¤ä¸ªæŒ‰é’® -->
    <div id="stageWrapper">
      <div id="stage"></div>
      <button id="startBtn">Start</button>

      <div id="floatingButtons">
        <button id="helpBtn" class="icon-btn">
          <img src="assets/icon_help.png" alt="Help">
        </button>
        <button id="aboutBtn" class="icon-btn">
          <img src="assets/icon_about.png" alt="About">
        </button>
        <button id="settingsBtn" class="icon-btn">
          <img src="assets/icon_settings.png" alt="Settings">
        </button>
      </div>
    </div>

    <!-- å¯ä»¥ä¿ç•™ä¸€ä¸ªå° HUDï¼Œå¦‚æœä½ æƒ³ä¹Ÿå¯ä»¥åœ¨ CSS é‡Œéšè— -->
    <div id="hud">
      <span id="stateTxt">state: live</span>
      <span id="micTxt">mic: idle</span>
      <span id="lvlTxt">level: 0.000</span>
      <span id="dbTxt">~ dB: -âˆ</span>
    </div>

    <!-- ========== è®¾ç½®å¼¹çª—ï¼ˆé‡Œé¢æ˜¯åŸæ¥çš„è°ƒè¯•é¢æ¿ï¼‰ ========== -->
    <div id="settingsOverlay" class="overlay">
      <div class="overlay-backdrop" id="settingsBackdrop"></div>
      <div class="overlay-card">
        <button class="close-btn" id="settingsClose">Ã—</button>
        <h2 class="overlay-title">Settings</h2>

        <div id="panel">
          <button id="calBtn">Calibrate 2s</button>
          <button id="muteBtn">Mute Mic</button>

          <label> Mic
            <select id="micSelect"></select>
          </label>
          <button id="refreshBtn">Refresh</button>

          <label> Sensitivity
            <input id="sens" type="range" min="0.05" max="4" value="1" step="0.05">
          </label>
          <label> Soft TH
            <input id="softTH" type="range" min="0.001" max="0.1" value="0.02" step="0.001">
          </label>
          <label> Loud TH
            <input id="loudTH" type="range" min="0.05" max="0.5" value="0.12" step="0.01">
          </label>

          <div id="meterWrap">
            <div id="meterBar"></div>
          </div>
          <div id="tips">
            Tip: If level stays at 0, check browser mic permission or click Start again.
          </div>
        </div>
      </div>
    </div>

    <!-- ========== æŒ‡å—å¼¹çª—ï¼ˆäº¤äº’è¯´æ˜ï¼‰ ========== -->
    <div id="helpOverlay" class="overlay">
      <div class="overlay-backdrop" id="helpBackdrop"></div>
      <div class="overlay-card">
        <button class="close-btn" id="helpClose">Ã—</button>
        <h2 class="overlay-title">How to Test</h2>
        <div id="helpContent">

          <p><b>MatchaTone reacts to your sound and touch.</b><br>
          Here are the ways you can interact with the character:</p>

          <h4>ğŸ¤ Sound</h4>

          <p><b>Soft sound â†’ Listening</b><br>
          Speak gently, hum, or blow softly.<br>
          Hold the soft sound for <b>about 0.5 seconds</b> to trigger Listening.</p>

          <p><b>Loud sound â†’ Shy</b><br>
          Clap, speak loudly, or make a sudden noise.<br>
          A loud sound triggers the Shy reaction immediately.</p>

          <p><b>Silence â†’ Sleep</b><br>
          Stay quiet for <b>10 seconds</b>.<br>
          MatchaTone will enter Sleep, and a small sound or tap will wake it.</p>

          <h4>ğŸ‘† Touch</h4>
          <ul>
            <li><b>Tap the character</b> â†’ triggers Happy (with music)</li>
          </ul>

          <h4>â­ States</h4>
          <ul>
            <li><b>Live</b> â€“ the default idle state</li>
            <li><b>Listening</b> â€“ triggered by soft, steady sound</li>
            <li><b>Happy</b> â€“ triggered by tapping, with joyful BGM</li>
            <li><b>Shy</b> â€“ startled by loud sound</li>
            <li><b>Sleep</b> â€“ triggered by long silence, with calming sleep BGM</li>
          </ul>

          <h4>ğŸ’¡ Tips</h4>
          <ul>
            <li>Hold your soft sound steadily to enter Listening.</li>
            <li>Loud noises will interrupt Listening.</li>
            <li>Heavy background noise may affect detection.</li>
            <li>The character feels more alive when you mix sound, silence, and touch.</li>
          </ul>

        </div>


      </div>
    </div>

  </div>
  <script src="sketch.js"></script>
</body>
</html>

    <!-- ========== å…³äºè§’è‰²å¼¹çª—ï¼ˆaboutOverlayï¼‰ ========== -->
    <div id="aboutOverlay" class="overlay">
      <div class="overlay-backdrop" id="aboutBackdrop"></div>
      <div class="overlay-card">
        <button class="close-btn" id="aboutClose">Ã—</button>
        <h2 class="overlay-title">About MatchaTone</h2>
        <div id="aboutContent">
          <p>
            MatchaTone is a gentle companion that listens, reacts, and rests.
            It breathes with sound, blushes when surprised, and smiles when touched.
            A small window into emotion through simple interaction.
          </p>
        </div>
      </div>
    </div>
